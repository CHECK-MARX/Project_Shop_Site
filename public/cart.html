<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚«ãƒ¼ãƒˆ - Vulnerable Shop</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header class="navbar">
    <div class="nav-brand"><h1>ğŸ›’ Vulnerable Shop</h1></div>
    <div class="nav-links">
      <a href="/">ãƒ›ãƒ¼ãƒ </a>
      <a href="/products.html">å•†å“</a>
      <a href="/cart.html">ã‚«ãƒ¼ãƒˆ</a>
      <a href="/checkout.html">æ±ºæ¸ˆ</a>
    </div>
  </header>
  <main class="cart-section">
    <h2>ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆ</h2>
    <div id="items" class="cart-items"></div>
    <div class="cart-total"><h3>åˆè¨ˆ: <span id="total">Â¥0</span></h3>
      <a class="btn btn-success" href="/checkout.html">ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã¸</a></div>
  </main>
  <script>
    async function fetchProduct(id){ const r=await fetch(`/api/product/${id}`); return r.json(); }
    async function render(){
      const itemsDiv = document.getElementById('items');
      const totalEl = document.getElementById('total');
      const cart = JSON.parse(localStorage.getItem('cart')||'[]');
      if(cart.length===0){ itemsDiv.innerHTML = '<p>ã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™</p>'; totalEl.textContent='Â¥0'; return; }
      let total=0; let html='';
      for(const it of cart){ const p = await fetchProduct(it.productId); const t = p.price*it.quantity; total+=t;
        html += `
          <div class="cart-item">
            <div><h4>${p.name}</h4><p>æ•°é‡: ${it.quantity}</p></div>
            <div><span class="product-price">Â¥${t}</span>
              <button class="btn btn-danger" onclick="rm(${it.productId})">å‰Šé™¤</button></div>
          </div>`;
      }
      itemsDiv.innerHTML = html;
      totalEl.textContent = 'Â¥'+total.toFixed(2);
    }
    function rm(id){ const c=JSON.parse(localStorage.getItem('cart')||'[]').filter(i=>i.productId!==id); localStorage.setItem('cart', JSON.stringify(c)); render(); }
    render(); window.rm = rm;
  </script>
</body>
</html>

