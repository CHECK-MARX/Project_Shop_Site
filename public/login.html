<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ­ã‚°ã‚¤ãƒ³ - Vulnerable Shop</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header class="navbar">
    <div class="nav-brand"><h1>ğŸ›’ Vulnerable Shop</h1></div>
    <div class="nav-links">
      <a href="/">ãƒ›ãƒ¼ãƒ </a>
      <a href="/products.html">å•†å“</a>
      <a href="/cart.html">ã‚«ãƒ¼ãƒˆ</a>
      <a href="/checkout.html">æ±ºæ¸ˆ</a>
    </div>
  </header>
  <main class="cart-section" style="max-width:480px;">
    <h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>
    <div id="msg"></div>
    <form id="loginForm" class="cart-items">
      <div class="form-group">
        <label>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label>
        <input type="text" id="username" required>
      </div>
      <div class="form-group">
        <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
        <input type="password" id="password" required>
      </div>
      <button class="btn btn-primary" type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </form>
  </main>
  <script>
    const msg = document.getElementById('msg');
    function show(m, t='info'){ msg.innerHTML = `<div class="alert alert-${t}">${m}</div>` }
    document.getElementById('loginForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      try{
        const res = await fetch('/api/login', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({username, password})});
        const data = await res.json();
        if(!res.ok) throw new Error(data.error||'login failed');
        localStorage.setItem('user', JSON.stringify(data.user));
        localStorage.setItem('token', data.token);
        show(`ã‚ˆã†ã“ã <b>${username}</b> ã•ã‚“`, 'success');
        setTimeout(()=>location.href='/products.html', 800);
      }catch(err){ show('ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: '+err.message, 'danger'); }
    });
    // åˆ¥ãƒšãƒ¼ã‚¸ã®ç™»éŒ²ã¸å°ç·š
    const reg = document.createElement('p');
    reg.style.textAlign = 'center';
    reg.style.marginTop = '1rem';
    reg.innerHTML = 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæœªä½œæˆã®æ–¹ã¯ <a href="/register.html">ã“ã¡ã‚‰</a> ã‹ã‚‰ç™»éŒ²';
    document.querySelector('main').appendChild(reg);
  </script>
</body>
</html>

